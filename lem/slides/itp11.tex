%!TEX TS-program = latex
\documentclass[pdf,nototal]{prosper}

\usepackage{../tex-lib/lem}

\usepackage{amsmath,amssymb}
%tjr hack to remove bounding box
\renewcommand{\BasicFrame}[1]{%
\ifinColor
\else
\fi
% \psline[linewidth=.5pt,linecolor=grayb](-1,0)(-1,-0.6)(-0.4,-0.6)
% \psline[linewidth=.5pt,linecolor=grayb](11,-0.6)(11.6,-0.6)(11.6,0)
% \psline[linewidth=.5pt,linecolor=grayb](-1,6.7)(-1,7.3)(-0.4,7.3)
% \psline[linewidth=.5pt,linecolor=grayb](11.6,6.7)(11.6,7.3)(11,7.3)
  \PutLogo % Mandatory
 {#1}}

\definecolor{titlec}{rgb}{.2,0,.8}
\definecolor{etextc}{rgb}{0.7,0.2,0.4}
\definecolor{FriendlyBlue}{rgb}{0,0,1}
\definecolor{FriendlyMagenta}{rgb}{0.8,0,0.8}
\definecolor{dr}{rgb}{0.8,0,0.8}

\newcommand{\titlec}{\color{titlec}}
\newcommand{\etextc}{\color{etextc}}
\newcommand{\highlightbold}[1]{{\color{etextc}\bfseries #1}}


\newcommand{\mytitlefont}{\titlec\usefont{T1}{phv}{m}{n}\fontsize{16.4pt}{16pt}\selectfont}
\newcommand{\mytextfont}{\usefont{T1}{phv}{m}{n}\fontsize{12.4pt}{12pt}\selectfont}
\FontText{\mytextfont}{\mytextfont}
\FontTitle{\mytitlefont}{\mytitlefont}%\titlec\sf\large}

 
\begin{document}

\begin{slide}{}
\begin{center}
\vspace{24pt}
{\mytitlefont Lem: A Lightweight Tool for Heavyweight Semantics}\\[18pt]
{\fontsize{14pt}{14pt}\selectfont{{\color{FriendlyMagenta} Scott~Owens$^1$}\quad Peter~B\"ohm$^1$ Francesco~Zappa~Nardelli$^2$ \quad Peter~Sewell$^1$}}\\[12pt]
{$^1$University of Cambridge \qquad $^2$INRIA}\\[12pt]
\url{http://www.cl.cam.ac.uk/~so294/lem/}\\[24pt]
23 August, 2011\\
ITP

\end{center}
\end{slide}

\begin{slide}{Heavyweight Semantics}
At Cambridge (with INRIA, NICTA, IBM, and others):\\
TCP; an optical network switch; Java module system;
OCaml${}_{\text{light}}$; {\color{FriendlyBlue}C/C++ concurrency};
x86, {\color{FriendlyBlue}POWER} and {\color{FriendlyBlue}ARM}
multicore relaxed memory; CompCertTSO verified compiler; {\color{FriendlyBlue}C1x} semantics

\vspace{12pt}

\begin{itemize}
\item realistic systems
\item large definitions (thousands of lines)
\item testing tools/automation
\item sometimes proof (later)
\item experience with Coq, HOL4, Isabelle/HOL, Ott
\end{itemize}

{\small \color{FriendlyBlue}Using Lem}

\end{slide}

\begin{slide}{Lem: a Lightweight Tool}

\begin{center}An engineering challenge \end{center}
%PS: SUGGEST EMPHASISING HERE (ON SLIDE AND IN SOUNDTRACK) THAT NONE OF
%THIS IS ROCKET SCIENCE, AND SEVERAL PROVERS DO SOME OF THE THINGS LEM
%DOES (MORE-OR-LESS) --- BUT LEM IS CAREFULLY ENGINEERED TO ``JUST WORK''
%IN WAYS THAT MATTER FOR THESE LARGE PROJECTS. WHEREAS PROVER (EG)
%DATATYPE PACKAGES HAVE ACCRETED...
%

\vspace{12pt}

\begin{itemize}
\item support human-readable source files
\begin{itemize}
\item simple logic, rich ``programming language'' features
\end{itemize}
\item take the source text seriously
\item support execution
\item be quick and predictable
\begin{itemize}
\item catch target errors during translation
\end{itemize}
\end{itemize}

\vspace{24pt}

e.g., 25 kinds of expressions, 11 patterns
\end{slide}

\begin{slide}{Example in Lem}
{\small
\begin{verbatim}
let coherent_memory_use actions lk rf mo hb =
    (* CoRR *)
    ( forall ((x,a) IN rf) ((y,b) IN rf).
      ((a,b) IN hb && same_location a b && 
       is_at_atomic_location lk b) 
      -->
      ((x = y) || (x,y) IN mo) ) &&
\end{verbatim}}

\vspace{24pt}

{\color{dr} Misleading size : $\approx 1\%$}

\vspace{24pt}

{\footnotesize
From C++ M.\ M.\ (Batty, Owens, Sarkar, Sewell, Weber in POPL11)\\
}
\end{slide}
%
%\begin{slide}{Example in Latex}
%PS: WOULD SKIP THIS
%{\small
%\begin{verbatim}
%\lemdef{
%\lemkw{let}\  \lemTermVar{coherent\_memory\_use}\  \lemTermVar{actions}\  \lemTermVar{lk}\  \lemTermVar{rf}\  \lemTermVar{mo}\  \lemTermVar{hb} =\\{}
%\ \ \ \ \tsholcomm{(* CoRR *)}\\{}
%\ \ \ \ ( \forall (\lemTermVar{x},\,\lemTermVar{a}) \mathord{\in}  \lemTermVar{rf}\  (\lemTermVar{y},\,\lemTermVar{b}) \mathord{\in}  \lemTermVar{rf}.\\{}
%\ \ \ \ \ \ ((\lemTermVar{a},\,\lemTermVar{b})\ \in\  \lemTermVar{hb}\ \lemwedge\  (\lemTermConst{same\_location}\  \lemTermVar{a}\  \lemTermVar{b}\ \lemwedge\  \\{}
%\ \ \ \ \ \ \ \lemTermConst{is\_at\_atomic\_location}\  \lemTermVar{lk}\  \lemTermVar{b}))\  \\{}
%\ \ \ \ \ \ \lemTermConst{--\mbox{$>$} }\\{}
%\ \ \ \ \ \ ((\lemTermVar{x}\  \lemTermConst{=}\  \lemTermVar{y})\ \lemvee\  ((\lemTermVar{x},\,\lemTermVar{y})\ \in\  \lemTermVar{mo})) )\ \lemwedge\\{}
%}
%\end{verbatim}}
%\end{slide}
%
\begin{slide}{Example in Latex}

%DANGER: EXAMPLE TOO SMALL TO SEE POINT --- MAYBE INCLUDE A SMALL-FONT
%PAGE OF FULL C++ DEFN (MARK HAD IN HIS SLIDES) --- CAN SPEAK TO NEED
%FOR LAYOUT ETC. WRT THAT?
{\small
\lemdef{
\lemkw{let}\  \lemTermVar{coherent\_memory\_use}\  \lemTermVar{actions}\  \lemTermVar{lk}\  \lemTermVar{rf}\  \lemTermVar{mo}\  \lemTermVar{hb} =\\{}
\ \ \ \ \tsholcomm{(* CoRR *)}\\{}
\ \ \ \ ( \forall (\lemTermVar{x},\,\lemTermVar{a}) \mathord{\in}  \lemTermVar{rf}\  (\lemTermVar{y},\,\lemTermVar{b}) \mathord{\in}  \lemTermVar{rf}.\\{}
\ \ \ \ \ \ ((\lemTermVar{a},\,\lemTermVar{b})\ \in\  \lemTermVar{hb}\ \lemwedge\  \lemTermConst{same\_location}\  \lemTermVar{a}\  \lemTermVar{b}\ \lemwedge\  \\{}
\ \ \ \ \ \ \ \lemTermConst{is\_at\_atomic\_location}\  \lemTermVar{lk}\  \lemTermVar{b})\  \\{}
\ \ \ \ \ \ \lemTermConst{$\longrightarrow$}\\{}
\ \ \ \ \ \ ((\lemTermVar{x}\  \lemTermConst{=}\  \lemTermVar{y})\ \lemvee\  (\lemTermVar{x},\,\lemTermVar{y})\ \in\  \lemTermVar{mo}) )\ \lemwedge\\{}
}
}
\end{slide}


\begin{slide}{Example in OCaml}
{\footnotesize
\begin{verbatim}
let coherent_memory_use actions lk rf mo hb =
    (* CoRR *)
    ( Pset.for_all (fun (x,a) -> Pset.for_all (fun (y,b) -> 
      (not 
      ( Pset.mem (a,b)  hb && (same_location a b && 
       is_at_atomic_location lk b)) || 
      ((x = y) || Pset.mem  (x,y)  mo))) rf) rf ) &&
\end{verbatim}}
\end{slide}

\begin{slide}{Example in HOL-4}
{\small
\begin{verbatim}
 coherent_memory_use actions lk rf mo hb =
    (* CoRR *)
    ( ! ((x,a) :: rf) ((y,b) :: rf).
      ((a,b) IN hb /\ same_location a b /\ 
       is_at_atomic_location lk b) 
      ==>
      ((x = y) \/ (x,y) IN mo) ) /\
\end{verbatim}}
\end{slide}

\begin{slide}{Example in Isabelle/HOL}
{\small
\begin{verbatim}
definition coherent_memory_use  :: "(Atomic.action)set  => [num  =>  Atomic.location_kind] => (Atomic.action*Atomic.action)set  => (Atomic.action*Atomic.action)set  => (Atomic.action*Atomic.action)set  =>  bool "  where 
 " coherent_memory_use actions lk rf mo hb == 
    (* CoRR *)
    (( ALL (x,a) : rf.  ALL (y,b) : rf. 
      ( isa_set_mem (a,b)  hb & same_location a b & 
       is_at_atomic_location lk b) 
      -->
      ((x = y) | isa_set_mem  (x,y)  mo)) ) &
\end{verbatim}}
\end{slide}

\begin{slide}{Features}

\begin{center}Logical intersection, syntactic sugar union\end{center}
\vspace{24pt}
\begin{itemize}
\item higher-order functions
\item recursive functions and inductive relations
\item list and set comprehensions
\item ML-style polymorphism
\item simple type classes
\item algebraic and record datatypes
\end{itemize}

\end{slide}

\begin{slide}{Lem as an Intermediate Language}
\[\input{lem_trans.pstex_t}\]
\end{slide}

\begin{slide}{Lem and Ott}
Ott: 
\begin{itemize}
\item rich syntax support
\item lacking sets, functions, polymorphism, etc.
\item for PL formalisation only
\end{itemize}

\vspace{12pt}

Lem:
\begin{itemize}
\item generally applicable
\item rich higher-order logic
\item lacking rich syntactic extension
\end{itemize}
\end{slide}

\begin{slide}{Conclusion}

\begin{center}Lem is work in progress\end{center}

\vspace{24pt}

C, C++, POWER, and ARM models\\[12pt]

Exports OCaml, HOL-4, Isabelle/HOL, Latex, and soon Coq\\[12pt]

Imports \ldots\\[24pt]



Get Lem alpha version: \url{http://www.cl.cam.ac.uk/~so294/lem/}

\end{slide}

\begin{slide}{"Lem"?}

Lightweight executable mathematics\\[24pt]

Stanis\l{}aw Lem\\[24pt]

Lemma

\end{slide}

\end{document}
