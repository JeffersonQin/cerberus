(* Created by Victor Gomes 2017-04-30 *)

open Pp_prelude
open Pp_ocaml

let std_filename = "coreStd.ml"

let print_head filename =
  !^"(* Generated by Cerberus *)" ^//^
  !^"module A = Rt_ocaml" ^/^
  !^"module M = Mem" ^/^
  !^"module I = Mem.Impl" ^/^
  !^"module T = AilTypes" ^/^
  !^"module C = Core_ctype" ^/^
  !^"module B = Nat_big_num" ^//^
  !^"let (>>=) = M.bind0" ^/^
  !^"let rec _std_function_printf cont xs args =\
     \n  A.printf conv_int xs args >>= fun x -> cont x"

let gen globs impl stdlib =
  let contents =
    print_head std_filename ^^
    print_impls globs impl ^^
    print_funs globs stdlib ~init:false
  in
  let oc = open_out std_filename in
  P.ToChannel.pretty 1. 80 oc contents;
  close_out oc
