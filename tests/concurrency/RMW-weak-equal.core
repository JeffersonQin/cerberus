{- The weak compare_exchange can always fail, even if the compared
values are equal. If it succeeds then the value of x will be 1, and
the value of y will still be 0. Otherwise, the values of x and y will
still be 0. An exhaustive execution will therefore return 5 and 0 -}

{-
fun main () : [integer] :=
  x <- create(_Atomic(signed int));
  y <- create(signed int);
  store(_Atomic(signed int), x, 0);
  store(signed int, y, 0);
  success <- compare_exchange_weak(signed int, x, y, 1, seq_cst, seq_cst);
  a <- load(_Atomic(signed int), x);
  b <- load(signed int, y);
  ret a + 2 * b + 4 * success
-}
fun main () : [integer] :=
  let strong x = create(<alignof>("_Atomic(signed int)"), "_Atomic(signed int)") in
  let strong y = create(<alignof>("signed int"), "signed int") in
  let strong _ = store("_Atomic(signed int)", x, 0) in
  let strong _ = store("signed int", y, 0) in
  let strong success = compare_exchange_weak("signed int", x, y, 1, seq_cst, seq_cst) in
  let strong a = load("_Atomic(signed int)", x) in
  let strong b = load("signed int", y) in
  return(a + 2 * b + 4 * success)
  end end end end end end end
