{- SB+Wsc_Rsc+Wsc_Rsc Store Buffering (or Dekker's), with sequential
   consistent atomics. The reads cannot both see 0 in the same
   execution. This contrasts with SB with release/acquire pairs where
   the reads can both see 0. An exhaustive execution of this program
   should return the values 1, 2, 3.  -}

fun main () : [integer] :=
  x <- create(_Atomic(signed int));
  store(_Atomic(signed int), x, 0);
  y <- create(_Atomic(signed int));
  store(_Atomic(signed int), y, 0);
  (a1, a2) <- {{{
       store(_Atomic(signed int), y, 1, seq_cst);
       load(_Atomic(signed int), x, seq_cst)
  |||
       store(_Atomic(signed int), x, 1, seq_cst);
       load(_Atomic(signed int), y, seq_cst)
  }}};
  kill(x);
  kill(y);
  ret a1 + (2 * a2)
