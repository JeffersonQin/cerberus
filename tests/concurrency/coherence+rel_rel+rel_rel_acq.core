{- The coherence axioms CoWW and CoWR forbid that the load reads from the write x = 2, but it 
   can read from all other writes. The allowed outcomes are therefore 0, 1 and 3.
-}

fun main () : [integer] :=
  x <- create(_Atomic(signed int));
  z <- create(signed int);
  (a, b) <- {{{
      store(_Atomic(signed int), x, 0, release);
      store(_Atomic(signed int), x, 1, release)
  |||
      store(_Atomic(signed int), x, 2, release);
      store(_Atomic(signed int), x, 3, release);
      load(_Atomic(signed int), x, acquire)
  }}};
  kill(x);
  kill(z);
  ret b
