{- The coherence axioms CoWW and CoWR forbid that the load reads from the write x = 2, but it 
   can read from all other writes. The allowed outcomes are therefore 0, 1 and 3.
-}

fun main () : [integer] :=
  x <- create(_Atomic(signed int));
  z <- create(signed int);
  {{{
      store(_Atomic(signed int), x, 0, release);
      store(_Atomic(signed int), x, 1, release)
  |||
      store(_Atomic(signed int), x, 2, release);
      store(_Atomic(signed int), x, 3, release);
      a <- load(_Atomic(signed int), x, acquire);
      store(signed int, z, a)
  }}};
  a <- load(signed int, z);
  kill(x);
  kill(z);
  ret a
